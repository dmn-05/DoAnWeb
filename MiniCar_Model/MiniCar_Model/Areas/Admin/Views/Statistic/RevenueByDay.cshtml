@model MiniCar_Model.Models.ViewModels.RevenueFilterViewModel

<section id="main-content">
  <section class="wrapper">

    <h3>
      <i class="fa fa-line-chart"></i>
      Thống kê doanh thu theo ngày
    </h3>

    <!-- ===== FORM CHỌN NGÀY ===== -->
    <div class="row mt">
      <div class="col-lg-12">
        <div class="content-panel">
          <h4><i class="fa fa-filter"></i> Lọc theo ngày</h4>

          <div class="panel-body">
            <form method="get" class="form-inline">

              <div class="form-group mr-3">
                <label>Từ ngày</label>
                <input type="date"
                       name="FromDate"
                       value="@(Model.FromDate?.ToString("yyyy-MM-dd"))"
                       class="form-control ml-2" />
              </div>

              <div class="form-group mr-3">
                <label>Đến ngày</label>
                <input type="date"
                       name="ToDate"
                       value="@(Model.ToDate?.ToString("yyyy-MM-dd"))"
                       class="form-control ml-2" />
              </div>

              <button type="submit" class="btn btn-primary">
                <i class="fa fa-search"></i> Thống kê
              </button>

            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== BIỂU ĐỒ ===== -->
    <div class="row mt">
      <div class="col-lg-12">
        <div class="content-panel">
          <h4>
            <i class="fa fa-bar-chart"></i>
            Biểu đồ doanh thu theo ngày
          </h4>

          <!-- panel-body BẮT BUỘC để không tràn -->
          <div class="panel-body" style="height:360px">
            <canvas id="revenueDayChart"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== BẢNG DỮ LIỆU ===== -->
    <div class="row mt">
      <div class="col-lg-12">
        <div class="content-panel">
          <h4><i class="fa fa-table"></i> Chi tiết</h4>

          <table class="table table-bordered table-striped">
            <thead>
              <tr>
                <th>Ngày</th>
                <th>Số đơn</th>
                <th>Doanh thu</th>
              </tr>
            </thead>
            <tbody>
              @foreach (var item in Model.Data)
              {
                <tr>
                  <td>@item.Label</td>
                  <td>@item.OrderCount</td>
                  <td>@item.Revenue.ToString("N0") ₫</td>
                </tr>
              }
            </tbody>
          </table>

        </div>
      </div>
    </div>

  </section>
</section>

@section Scripts {
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <script>
    const ctx = document.getElementById('revenueDayChart');

    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
     Model.Data.Select(x => x.Label))),
        datasets: [{
          label: 'Doanh thu',
          data: @Html.Raw(System.Text.Json.JsonSerializer.Serialize(
       Model.Data.Select(x => x.Revenue))),
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function (value) {
                return value.toLocaleString();
              }
            }
          }
        }
      }
    });
  </script>
}
