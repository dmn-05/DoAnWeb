@{
  ViewData["title"] = "Admin";
  int currentPage = ViewBag.CurrentPage ?? 1;
  int totalPages = ViewBag.TotalPages ?? 1;
}

@model IEnumerable<CommentIndexVM>

<section id="main-content">
  <section class="wrapper">
    <h3><i class="fa fa-angle-right"></i> Bình luận</h3>

    <div class="row mt">
      <div class="col-md-12">
        <div class="content-panel">

          <div style="padding: 15px;">
            <div class="row">
              <div class="col-md-4 col-sm-12">
                <h4 style="margin-bottom: 15px;">
                  <i class="fa fa-angle-right"></i> Danh sách
                </h4>
              </div>

              <div class="col-md-8 col-sm-12 text-right search-area">

                <!-- SEARCH -->
                <form asp-action="Index" method="get" class="search-bar">
                  <input type="text"
                         name="search"
                         value="@ViewBag.Search"
                         class="form-control search-input"
                         placeholder="Tìm kiếm bình luận..." />
                  <button class="btn btn-primary">
                    <i class="fa fa-search"></i>
                  </button>
                </form>

              </div>
            </div>
          </div>

          <hr style="margin:0;" />
          @await Html.PartialAsync("_AlertPartial")

          <!-- TABLE -->
          <div class="table-responsive">
            <table class="table table-hover table-sm">
              <thead>
                <tr>
                  <th class="text-center">#</th>
                  <th>Mã BL</th>
                  <th>Tài khoản</th>
                  <th class="text-center">Rating</th>
                  <th>Nội dung</th>
                  <th class="text-center">Trạng thái</th>
                  <th class="text-center">Hành động</th>
                </tr>
              </thead>
              <tbody>
                @{
                  int index = 1;
                }
                @foreach (var c in Model)
                {
                  <tr>
                    <td class="text-center">@index</td>
                    <td>@c.CommentId</td>
                    <td>@c.AccountName</td>
                    <td class="text-center">
                      @if (c.Rating.HasValue)
                      {
                        <span class="badge bg-theme">@c.Rating</span>
                      }
                      else
                      {
                        <span class="text-muted">N/A</span>
                      }
                    </td>
                    <td style="max-width:300px"
                        class="text-truncate">
                      @c.Content
                    </td>
                    <td class="text-center">
                      @if (c.StatusComment == "ACTIVE")
                      {
                        <span class="label label-success label-mini">ACTIVE</span>
                      }
                      else
                      {
                        <span class="label label-danger label-mini">INACTIVE</span>
                      }
                    </td>
                    <td class="text-center" style="white-space:nowrap">


                      @if (c.StatusComment != "INACTIVE")
                      {

                        <!-- XÓA MỀM -->
                        <form asp-action="Delete"
                              asp-route-id="@c.CommentId"
                              method="post"
                              class="d-inline"
                              onsubmit="return confirm('Bạn có chắc muốn xóa bình luận này?');">
                          @Html.AntiForgeryToken()
                          <button type="submit" class="btn btn-danger btn-xs">
                            <i class="fa fa-trash"></i> Xóa
                          </button>
                        </form>
                      }
                      else
                      {
                        <!-- KHÔI PHỤC -->
                        <form asp-action="Restore"
                              asp-route-id="@c.CommentId"
                              method="post"
                              class="d-inline"
                              onsubmit="return confirm('Khôi phục bình luận này?');">
                          @Html.AntiForgeryToken()
                          <button type="submit" class="btn btn-success btn-xs">
                            <i class="fa fa-undo"></i> Khôi phục
                          </button>
                        </form>
                      }
                    </td>
                  </tr>
                  index++;
                }
              </tbody>
            </table>
          </div>
        </div>

        <!-- PAGINATION -->
        <div class="text-center" style="margin-top:20px;">
          <ul class="pagination">

            <li class="page-item @(currentPage <= 1 ? "disabled" : "")">
              @if (currentPage > 1)
              {
                <a class="page-link"
                   href="@Url.Action("Index", new { page = currentPage - 1, search = ViewBag.Search })">«</a>
              }
              else
              {
                <span class="page-link">«</span>
              }
            </li>

            @for (int i = 1; i <= totalPages; i++)
            {
              <li class="page-item @(i == currentPage ? "active" : "")">
                @if (i == currentPage)
                {
                  <span class="page-link">@i</span>
                }
                else
                {
                  <a class="page-link"
                     href="@Url.Action("Index", new { page = i, search = ViewBag.Search })">@i</a>
                }
              </li>
            }

            <li class="page-item @(currentPage >= totalPages ? "disabled" : "")">
              @if (currentPage < totalPages)
              {
                <a class="page-link"
                   href="@Url.Action("Index", new { page = currentPage + 1, search = ViewBag.Search })">»</a>
              }
              else
              {
                <span class="page-link">»</span>
              }
            </li>

          </ul>
        </div>

      </div>
    </div>
  </section>
</section>

@await Html.PartialAsync("_ConfirmDeleteModal")
