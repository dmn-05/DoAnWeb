
@model List<MiniCar_Model.Models.ViewModels.OrderVM>
@{
	ViewData["Title"] = "Danh sách đơn hàng";
}

<section class="banner-area organic-breadcrumb">
	<div class="container">
		<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
			<div class="col-first">
				<h1>Danh sách đơn hàng</h1>
				<nav class="d-flex align-items-center">
					<a asp-controller="Home" asp-action="Index">Trang chủ<span class="lnr lnr-arrow-right"></span></a>
					<a asp-controller="Account" asp-action="Profile">Tài khoản<span class="lnr lnr-arrow-right"></span></a>
					<a href="#">Đơn hàng</a>
				</nav>
			</div>
		</div>
	</div>
</section>
<div class="container my-4">
	<div class="row align-items-center mb-3">
		<div class="col-6">
			<button class="btn btn-outline-secondary btn-sm" onclick="history.back()">
				<span class="lnr lnr-arrow-left"></span>  Quay lại
			</button>
		</div>
	</div>

	<ul class="nav nav-tabs mb-4 flex-nowrap overflow-auto">
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Tất cả" ? "active" : "")"
				 asp-action="Order" asp-route-status="Tất cả">Tất cả</a>
		</li>
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Completed" ? "active" : "")"
				 asp-action="Order" asp-route-status="Completed">Completed</a>
		</li>
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Paid" ? "active" : "")"
				 asp-action="Order" asp-route-status="Paid">Paid</a>
		</li>
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Confirmed" ? "active" : "")"
				 asp-action="Order" asp-route-status="Confirmed">Confirmed</a>
		</li>
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Pending" ? "active" : "")"
				 asp-action="Order" asp-route-status="Pending">Pending</a>
		</li>
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Refunded" ? "active" : "")"
				 asp-action="Order" asp-route-status="Refunded">Refunded</a>
		</li>
		<li class="nav-item">
			<a class="nav-link @(ViewBag.CurrentStatus == "Cancelled" ? "active" : "")"
				 asp-action="Order" asp-route-status="Cancelled">Cancelled</a>
		</li>
	</ul>

	@if (Model != null && Model.Any()) {
		@foreach (var order in Model) {
			<div class="card shadow-sm rounded-4 mb-4 border-0">
				<div class="card-body">
					<div class="d-flex justify-content-between mb-3 border-bottom pb-2">
						<span class="text-muted small">Mã đơn: #@order.BillId | @order.CreateAt?.ToString("dd/MM/yyyy")</span>
						<span class="fw-semibold @(order.StatusBill?.Trim() == "Completed" ? "text-success" : "text-warning")">
							@order.StatusBill

						</span>
					</div>

					@* Vòng lặp duyệt qua từng món hàng trong 1 hóa đơn *@
					@foreach (var item in order.Items) {
						<div class="row align-items-center g-3 mb-3">
							<div class="col-3 col-md-2 text-center">
								<img src="@Url.Content(item.ImageUrl ?? "~/img/products/default.png")"
										 class="img-fluid rounded border shadow-sm" style="max-height: 80px;" alt="">
							</div>

							<div class="col-9 col-md-6">
								<h6 class="mb-1 text-dark">@item.ProductName</h6>
								<small class="text-muted">Số lượng: x@item.Quantity</small>
								<div class="d-md-none text-danger fw-semibold">@item.UnitPrice.ToString("N0")₫</div>
							</div>

							<div class="col-md-4 text-md-end d-none d-md-block">
								<div class="text-muted small">Giá đơn vị</div>
								<div class="fw-semibold text-danger">@item.UnitPrice.ToString("N0")₫</div>
							</div>
						</div>
					}

					<div class="border-top pt-3 mt-2">
						<div class="d-flex justify-content-between align-items-center">
							<div class="text-muted small">
							</div>
							<div class="text-end">
								<span class="text-muted small">Thành tiền:</span>
								<span class="text-danger fs-5 fw-bold ms-2">@order.TotalPrice ₫</span>
							</div>
						</div>
					</div>

					<div class="d-flex justify-content-end mt-3 gap-2">
						@if (order.StatusBill?.Trim() == "Pending") {
							<form asp-controller="Account" asp-action="CancelOrder" method="post">
								<input type="hidden" name="id" value="@order.BillId" />
								<button type="submit" class="btn btn-outline-danger btn-sm"
												onclick="return confirm('Bạn có chắc chắn muốn hủy đơn hàng #@order.BillId này không?')">
									Hủy đơn hàng
								</button>
							</form>
						} else {
							<button class="btn btn-outline-secondary btn-sm">
								Mua lại
							</button>

							@if (order.StatusBill?.Trim() == "Completed") {
								<button class="btn btn-outline-danger btn-sm">
									Viết đánh giá
								</button>
							}
						}
					</div>
				</div>
			</div>
		}
	} else {
		<div class="text-center py-5">
			<i class="lnr lnr-cart fs-1 text-muted"></i>
			<p class="mt-3 text-muted">Bạn chưa có đơn hàng nào.</p>
			<a asp-controller="Home" asp-action="Index" class="primary-btn mt-2" style="line-height: 38px; padding: 0 30px;">Mua sắm ngay</a>
		</div>
	}
</div>