@model MiniCar_Model.Models.ViewModels.CartViewModel


@{
	ViewData["Title"] = "Giỏ Hàng";
}

<style>
	.cart-item {
		transition: background-color 0.2s ease;
	}

		.cart-item.active {
			background-color: #fff4f4;
			box-shadow: inset 4px 0 0 #d70018;
		}
</style>
<section class="banner-area organic-breadcrumb">
	<div class="container">
		<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
			<div class="col-first">
				<h1>Giỏ hàng</h1>
				<nav class="d-flex align-items-center">
					<a href="index.html">Trang chủ<span class="lnr lnr-arrow-right"></span></a>
					<a href="cart.html">Giỏ hàng</a>
				</nav>
			</div>
		</div>
	</div>
</section>

<section class="cart_area mt-5">
	<div class="container">
		<div class="cart_inner">

			<div class="cart-title">
				<h1 class="cart-heading mb-3">GIỎ HÀNG CỦA TÔI</h1>

				<label class="fw-semibold text-muted d-inline-block mt-2">
					<input type="checkbox" id="toggleSelect" class="form-check-input me-2">
					Chọn nhiều sản phẩm
				</label>
			</div>

			<div class="table-responsive">
				<table class="table cart-table">
					<thead>
						<tr class="text-muted border-bottom">
							<th style="width:50%">Sản phẩm</th>
							<th class="text-center">Giá</th>
							<th class="text-center">Số lượng</th>
							<th class="text-center">Tổng tiền</th>
							<th class="text-center">Thao tác</th>
						</tr>
					</thead>

					<tbody>
						@foreach (var item in Model.Items)
						{
							<tr class="cart-item" data-price="@item.Price">
								<td>
									<div class="d-flex align-items-start ml-3">
										<input type="checkbox"
													 class="form-check-input product-check d-none me-2 mt-2">

										<img src="@item.ImageUrl" width="80" class="img-thumbnail me-3">

										<div>
											<h6 class="mb-1">@item.ProductName</h6>
											<small class="text-muted">Màu sắc: @item.ColorName</small>
										</div>
									</div>
								</td>

								<td class="text-center">
									<span class="fw-bold fs-5 text-danger price">
										@item.Price.ToString("N0")đ
									</span>
								</td>

								<td class="text-center">
									<input type="number"
												 value="@item.Quantity"
												 min="1"
												 step="1"
												 inputmode="numeric"
												 class="form-control text-center mx-auto qty-input"
												 style="width:80px">

								</td>

								<td class="text-center text-danger fw-semibold line-total">
									@item.TotalPrice.ToString("N0")đ
								</td>

								<td class="text-center">
									<button class="btn btn-outline-danger btn-sm">
										<i class="lnr lnr-trash"> Loại bỏ</i>
									</button>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>

			<div class="d-flex justify-content-end mt-4">
				<div class="text-end">
					<h5>
						Tổng cộng:
						<span class="text-danger" id="cartTotal">
							@Model.TotalAmount.ToString("N0")đ
						</span>
					</h5>

					<div class="mt-3">
						<a class="btn btn-light me-2" href="/">Tiếp tục mua sắm</a>
						<a class="btn btn-warning text-white" href="/Checkout">Thanh toán</a>
					</div>
				</div>
			</div>

		</div>
	</div>
</section>


<script>
	const toggleSelect = document.getElementById("toggleSelect");
	const items = document.querySelectorAll(".cart-item");

	toggleSelect.addEventListener("change", function () {
		items.forEach(item => {
			const cb = item.querySelector(".product-check");
			cb.classList.toggle("d-none", !this.checked);
			cb.checked = false;
			item.classList.remove("active");
		});
	});

	document.querySelectorAll(".product-check").forEach(cb => {
		cb.addEventListener("change", function () {
			this.closest(".cart-item")
				.classList.toggle("active", this.checked);
		});
	});
</script>
<script>
	function formatVND(number) {
		return number.toLocaleString('vi-VN') + 'đ';
	}

	function updateCartTotal() {
		let total = 0;
		document.querySelectorAll('.line-total').forEach(el => {
			total += parseInt(el.dataset.value);
		});
		document.getElementById('cartTotal').innerText = formatVND(total);
	}

	document.querySelectorAll('.qty-input').forEach(input => {
		input.addEventListener('input', function () {
			const row = this.closest('.cart-item');
			const price = parseInt(row.dataset.price);
			const qty = parseInt(this.value) || 1;

			const lineTotal = price * qty;

			const lineTotalEl = row.querySelector('.line-total');
			lineTotalEl.innerText = formatVND(lineTotal);
			lineTotalEl.dataset.value = lineTotal;

			updateCartTotal();
		});
	});

	// Khởi tạo dataset ban đầu
	document.querySelectorAll('.line-total').forEach(el => {
		el.dataset.value = el.innerText.replace(/\D/g, '');
	});
</script>

<script>
	document.querySelectorAll('.qty-input').forEach(input => {

		input.addEventListener('keydown', function (e) {
			// Chặn: -, +, ., e (số mũ)
			if (['-', '+', '.', 'e', 'E'].includes(e.key)) {
				e.preventDefault();
			}
		});

		input.addEventListener('input', function () {
			let value = this.value.replace(/\D/g, '');

			if (value === '' || parseInt(value) < 1) {
				value = 1;
			}

			this.value = value;
		});

	});
</script>
